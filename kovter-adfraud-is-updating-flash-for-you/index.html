<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-e04OT7-3KO0/VZUnMweKFRI/AAAAAAAAE1U/R3eRUm8HV9o/s1600/2015-07-02_13h57_03.png" imageanchor="1"><img border="0" src="http://1.bp.blogspot.com/-e04OT7-3KO0/VZUnMweKFRI/AAAAAAAAE1U/R3eRUm8HV9o/s1600/2015-07-02_13h57_03.png" /></a></div><br /><br />Checking my systems I noticed multiple VM trying to grab last version of Flash and thought they were not properly setup allowing Flash Player to auto-update (which we do not want obviously - we want to keep them exploitable and also avoid behavioural/network noise).<br /><br />Looking a little more carefully, i understood that this was in fact Kovter tied activity.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-W3PPNUwuofY/VZUib2lwYpI/AAAAAAAAE1I/yGVe_lXA-9w/s1600/2015-07-02_11h55_33.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="168" src="http://3.bp.blogspot.com/-W3PPNUwuofY/VZUib2lwYpI/AAAAAAAAE1I/yGVe_lXA-9w/s640/2015-07-02_11h55_33.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-size: 12.8000001907349px;">Screenshot of Cuckoo Behavioural tab</span><br /><span style="font-size: 12.8000001907349px;">Process Tree - DllHost has been injected by Kovter</span></td></tr></tbody></table><br /><div class="separator" style="clear: both; text-align: center;"></div><br />And when this Flash updating started ? In my systems the 2015-06-29 it seems.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-s-QLMpgscq4/VZUSWSDQXsI/AAAAAAAAE0A/fXy4Dpfzn-o/s1600/2015-07-02_12h14_32.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="364" src="http://1.bp.blogspot.com/-s-QLMpgscq4/VZUSWSDQXsI/AAAAAAAAE0A/fXy4Dpfzn-o/s640/2015-07-02_12h14_32.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Screenshot of a search in Moloch Pcap Indexer</td></tr></tbody></table>The goal is most probably to close the door of the system to additional infection via DriveBy.<br /><br /><b>[Edit 2015-07-03]</b> <a href="http://sentrant.com/blog/">Sentrant</a> contacted me and has another idea about those flash player updates that makes a lot of sense :<br /><div style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: small;">"<i>Like most modern ad-fraud malware the developers have built Kovter to maximize the return on their ad-fraud. Currently video ads are worth considerably more than simple impression ads so in an attempt to "cash-in" on video ads the developers have added functionality to Kovter that allows it to play Flash videos</i></div><div style="background-color: white;"><div style="color: #222222; font-family: arial, sans-serif; font-size: small;"><i>Now understanding the above I believe that the installation/update of Flash is not an attempt to "close the door on future malware" but rather an attempt to ensure that Flash videos are loaded and playable on the host. Many advertising exchanges will either not serve, or decrease the bid price of flash ads (video) to hosts who are detected using a very old version of Flash. In-fact we have seen the same Flash update behaviour on almost every other ad-fraud malware families that we have analyzed.</i></div><div style="color: #222222; font-family: arial, sans-serif; font-size: small;">"</div><div style="color: #222222; font-family: arial, sans-serif; font-size: small;"><br /></div><span style="color: #222222; font-family: arial, sans-serif; font-size: x-small;">If all you have is a hammer, everything looks like a nail.</span></div><b><br /></b><b>[/Edit]</b><br /><br /><br />Note : This (&nbsp;<i>closing to others the door used to get inside</i> ) is not a new idea/concept at all.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-wNDlVLtOGmk/VZUav9nlCNI/AAAAAAAAE0c/JIJZi1Dhjyk/s1600/screenshot_2014-07-10_038.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="430" src="http://4.bp.blogspot.com/-wNDlVLtOGmk/VZUav9nlCNI/AAAAAAAAE0c/JIJZi1Dhjyk/s640/screenshot_2014-07-10_038.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Betabot - Option to "protect from future infection via Exploit Kits"<br />2014-07</td></tr></tbody></table>But the timing is interesting.<br /><br />----<br />I asked help for the reverse part.<br />So I have been confirmed it was Kovter activity. The config (see :&nbsp;<a href="http://pastebin.com/NjZtv8GR">http://pastebin.com/raw.php?i=NjZtv8GR</a>&nbsp;) includes those Flash update calls (and updates of Internet Explorer)<br />Kovter seems to have evolved a lot lately. Version 2.0.3.5 right now.<br />The big list of IPs might be a peer node list (P2P inside?)<br />----<br />PS: since Kovter is now distributed in Affiliate mode, it can be dropped in almost any vector, so any kind of Exploit Kit. Here it was Fiesta:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://1.bp.blogspot.com/-MG6uKwRoPhA/VZUeo0OxCTI/AAAAAAAAE0o/5073Jmqmmqw/s1600/2015-07-02_13h20_52.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="136" src="http://1.bp.blogspot.com/-MG6uKwRoPhA/VZUeo0OxCTI/AAAAAAAAE0o/5073Jmqmmqw/s640/2015-07-02_13h20_52.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8000001907349px;">Kovter dropped by Fiesta - 2015-07-02<br />Updating Flash Player :)</td></tr></tbody></table>but you'll find it dropped by &nbsp;Angler :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://4.bp.blogspot.com/-oJHNxI9EgY0/VZUfJ9XYlOI/AAAAAAAAE0w/sFarI9ooUbQ/s1600/2015-07-02_13h23_08.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="88" src="http://4.bp.blogspot.com/-oJHNxI9EgY0/VZUfJ9XYlOI/AAAAAAAAE0w/sFarI9ooUbQ/s640/2015-07-02_13h23_08.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8000001907349px;">Malvertising chain to Kovter via Angler EK<br />2015-07-02</td></tr></tbody></table>Nuclear Pack :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://4.bp.blogspot.com/-cL7T1TYVOUs/VZUg2_SAfZI/AAAAAAAAE08/VRW9E1_jOn4/s1600/2015-07-02_13h30_05.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="60" src="http://4.bp.blogspot.com/-cL7T1TYVOUs/VZUg2_SAfZI/AAAAAAAAE08/VRW9E1_jOn4/s640/2015-07-02_13h30_05.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8000001907349px;"><span style="font-size: 12.8000001907349px;">Nuclear Pack dropping Kovter and Tinba /</span><span style="background-color: white; font-family: arial, sans, sans-serif; font-size: 13px; text-align: start; white-space: pre-wrap;">in0odrfqwbio0sa/</span><br /><span style="font-size: 12.8000001907349px;">2015-04-26</span></td></tr></tbody></table>Neutrino :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://2.bp.blogspot.com/-apuQZvtIH8A/VZUUUVE6cnI/AAAAAAAAE0M/w7ce4P-iDH8/s1600/2015-07-02_12h36_52.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="37" src="http://2.bp.blogspot.com/-apuQZvtIH8A/VZUUUVE6cnI/AAAAAAAAE0M/w7ce4P-iDH8/s640/2015-07-02_12h36_52.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8000001907349px;">Neutrino dropping Kovter<br />2015-06-03</td></tr></tbody></table><br />or as a task in botnet &nbsp;(Example : <a href="https://www.virustotal.com/file/c1816f44146482293c4bba8ac70e400f2cde6a62fcbfeae344bdbc1f3147d237/analysis/">this smokeloader</a>&nbsp; [updopeserver .eu] or in some bedep (id:6001) instances )<br /><br />[Edit : Got a pass today on the oldest infection vector to Kovter (my bet is that it's the core team traffing there or some close partners). They used to spread it with Sakura then Styx, Sweet Orange..etc<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-faWQwO3vfxw/VZZoAsjIlII/AAAAAAAAE2A/ojO4luv7Pds/s1600/2015-07-03_12h40_54.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="58" src="http://1.bp.blogspot.com/-faWQwO3vfxw/VZZoAsjIlII/AAAAAAAAE2A/ojO4luv7Pds/s640/2015-07-03_12h40_54.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Infection chain to Angler EK dropping Kovter.<br />This chain has Heavy "anti-replay" filtering and<br />benefits from malvert traffic<br />2015-07-03</td></tr></tbody></table>[/edit]<br /><br /><b><u><br /></u></b><b><u>Files:</u></b>&nbsp;<a href="https://files.dontneedcoffee.com/index.php/s/bg209HFMdFUr0mC">Kovter_2015-07-02.zip</a><br /><b><u><br /></u></b><b><u>Thanks :</u></b><br /><a href="https://twitter.com/miekiemoes">Mieke Verburgh</a> (Malwarebytes) and <a href="https://twitter.com/Horgh_Rce">Horgh</a> for help.<br />For the tools : <a href="https://github.com/aol/moloch">Moloch</a>, <a href="http://cuckoosandbox.org/">Cuckoo</a>, <a href="https://github.com/brad-accuvant">Brad Spengler</a> from Accuvant and <a href="https://github.com/wmetcalf">Will Metcalf</a> from Emerging Threats<br /><br /><b><u>Read More :</u></b><br /><a href="http://www.cyphort.com/kovter-ad-fraud-trojan/">Kovter: Ad Fraud Trojan</a> - 2015-01-16 - Cyphort Labs<br /><br /><br />
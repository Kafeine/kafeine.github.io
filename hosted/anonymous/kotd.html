<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>The King of traffic distribution</title>

    <link rel="stylesheet" type="text/css" href="http://192.168.168.203:4000/assets/css/styles_feeling_responsive.css">

  

	<script src="http://192.168.168.203:4000/assets/js/modernizr.min.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
	<script>
		WebFont.load({
			google: {
				families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ]
			}
		});
	</script>

	<noscript>
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'>
	</noscript>


	<!-- Search Engine Optimization -->
	<meta name="description" content="Disclaimer: This post is hosted here as a courtesy to the author who prefers to remain anonymous. MDNC was not involved in any way with this study.">
  	
	
	
	
	
	<link rel="canonical" href="http://192.168.168.203:4000/hosted/anonymous/kotd.html">


	<!-- Facebook Open Graph -->
	<meta property="og:title" content="The King of traffic distribution">
	<meta property="og:description" content="Disclaimer: This post is hosted here as a courtesy to the author who prefers to remain anonymous. MDNC was not involved in any way with this study.">
	<meta property="og:url" content="http://192.168.168.203:4000/hosted/anonymous/kotd.html">
	<meta property="og:locale" content="en_EN">
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="MDNC | Malware don't need Coffee">
	
	


	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="Kafeine">
	<meta name="twitter:creator" content="Kafeine">
	<meta name="twitter:title" content="The King of traffic distribution">
	<meta name="twitter:description" content="Disclaimer: This post is hosted here as a courtesy to the author who prefers to remain anonymous. MDNC was not involved in any way with this study.">
	
	

	<link type="text/plain" rel="author" href="http://192.168.168.203:4000/humans.txt">

	

	

	<link rel="icon" sizes="32x32" href="http://192.168.168.203:4000/assets/img/favicon-32x32.png">

	<link rel="icon" sizes="192x192" href="http://192.168.168.203:4000/assets/img/touch-icon-192x192.png">

	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-180x180-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-152x152-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-144x144-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-120x120-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-114x114-precomposed.png">

	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-76x76-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-72x72-precomposed.png">

	<link rel="apple-touch-icon-precomposed" href="http://192.168.168.203:4000/assets/img/apple-touch-icon-precomposed.png">	

	<meta name="msapplication-TileImage" content="http://192.168.168.203:4000/assets/img/msapplication_tileimage.png">

	<meta name="msapplication-TileColor" content="#fabb00">


	

</head>
<body id="top-of-page" class="page-fullwidth">
	
	<div id="navigation" class="sticky">
  <nav class="top-bar" role="navigation" data-topbar>
    <ul class="title-area">
      <li class="name">
      <h1 class="show-for-small-only"><a href="http://192.168.168.203:4000" class="icon-fisticup"> MDNC | Malware don't need Coffee</a></h1>
    </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        

              

          
          
        

              

          
          
        

              

          
          
        

              

          
          
        

              

          
          
            
            
              <li class="divider"></li>
              <li><a href="http://192.168.168.203:4000/search/">Search</a></li>

            
            
          
        

              

          
          
            
            
              <li class="divider"></li>
              <li><a href="http://192.168.168.203:4000/faq/">FAQ</a></li>

            
            
          
        

              

          
          
            
            
              <li class="divider"></li>
              <li><a href="http://192.168.168.203:4000/contact/">Contact</a></li>

            
            
          
        
        
      </ul>

      <ul class="left">
        

              

          
          

            
            
              <li><a href="http://192.168.168.203:4000/blog/">Blog</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          

            
            
              <li><a href="http://192.168.168.203:4000/external/">External</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          

            
            

              <li class="has-dropdown">
                <a href="http://192.168.168.203:4000/refs/">References</a>

                  <ul class="dropdown">
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/actors/">Actors</a></li>
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/authors/">Authors</a></li>
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/cves/">CVEs</a></li>
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/eks/">EKs (Exploit Kits)</a></li>
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/malware/">Malware</a></li>
                    

                      

                      <li><a href="http://192.168.168.203:4000/refs/tds/">TDS (Traffic Distribution Systems)</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        

              

          
          

            
            
              <li><a href="http://192.168.168.203:4000/archive/">Archive</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          
        

              

          
          
        

              

          
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->

	

	

<div id="masthead-no-image-header">
	<div class="row">
		<div class="small-6 columns">
			<a id="logo" href="http://192.168.168.203:4000" title="MDNC | Malware don't need Coffee – You are lost? Hunt for the static dots. You are bored? Find more trackable dots.">
				<img src="http://192.168.168.203:4000/assets/img/logo.png" alt="MDNC | Malware don't need Coffee – You are lost? Hunt for the static dots. You are bored? Find more trackable dots.">
			</a>
		</div><!-- /.small-12.columns -->
	</div><!-- /.row -->
</div><!-- /#masthead -->








	


<div class="row t30">
	<div class="medium-12 columns">
		<article>
			<header>
				<p class="subheadline">Author of this hosted post prefers remaining anonymous</p>
				<h1>The King of traffic distribution</h1>
			</header>

			
			<p class="teaser">
				Disclaimer: This post is hosted here as a courtesy to the author who prefers to remain anonymous. MDNC was not involved in any way with this study.
			</p>
			

			<p>Disclaimer: This post is hosted here as a courtesy to the author who prefers to remain anonymous. MDNC was not involved in any way with this study.</p>

<h2 id="introduction">Introduction</h2>
<p>EITest is one of the longest malicious delivery campaigns that has continued to evolve. In the spring of 2017, it started redirecting Internet Explorer users to tech support scams in addition to the existing redirections with the fake Chrome fonts.</p>

<p>We believe the tech support scam campaign we are describing in this post is one of the most widespread and well organized because it relies on several schemes in addition to EITest, such as traffic redirection using a distributed system infrastructure.</p>

<p>Actors behind this campaign are generating hundreds of domains per day.The only purpose of those domains names is to redirect users to tech support scams or malicious websites.</p>
<h2 id="highlights">Highlights</h2>
<ul>
  <li>
    <p>We were able to redirect a considerable amount of traffic destined to Tech Support Scam websites to a controlled infrastructure for a period of 8 hours. After they fixed the flaw that allowed us to do that, we were able to bypass the new protection in place to take control again of the traffic for another 6 hours.</p>
  </li>
  <li>
    <p>We discovered a network of bots controlled by a fraudulent Traffic Monetization company</p>
  </li>
  <li>
    <p>We’ve collected a list of 1562+1294 compromised websites responsible for the redirections of users to scams</p>
  </li>
  <li>
    <p>The actors are generating over 100 new domains each day to serve TSS via <a href="http://www.freenom.com">Freenom</a></p>
  </li>
</ul>

<h2 id="the-scam">The scam</h2>
<p>The landing page sometimes changes, but always has the same goal: trying to take control of the browser so the user cannot close it, in hopes that they will panic and call the phone number for assistance.</p>

<p><img src="https://i.imgur.com/tSJMGVg.png" alt="TSS-IE" class="center" /></p>

<p>Tech support scammer (TSS) are sometimes changing the landing page to better abuse the browser. Anyhow, this is what the current landing page looks like.</p>

<p>People that call those numbers will be told how to install a remote control software so the interlocutor can show Windows log events and services to the user, pretending that those are signs of an infected machine. The crooks will then offer a remote reparation service varying from $100 to $600.</p>

<p><img src="https://i.imgur.com/ofxzCJt.png" alt="Tech Support Scammer" class="center" /></p>

<h2 id="look-at-different-redirection-mechanisms">Look at different redirection mechanisms</h2>
<p>While analyzing the different ways for a user to be redirected to those scam support pages that try to hijack the browsers, we quickly documented multiple different redirection schemes using many different infrastructure. For this reason, we believe that many differents actors are responsible for sending traffic to the redirection network. Let’s begin by describing the most prolific methods of redirections.</p>

<p><img src="https://i.imgur.com/lxHMnaw.png" alt="Redirections_mechanisms" class="center" /></p>

<h2 id="eitest-redirection">EITest Redirection</h2>
<p>EITest infected websites have the capability of injecting javascript in page upon loading. We can observe redirections to tech support scam (TSS) websites <a href="http://www.malware-traffic-analysis.net/2017/05/25/index3.html">since 2017</a>. The injection that occurs when the victim’s user-agent is IE, Edge or Firefox, is the following:</p>

<p><img src="https://i.imgur.com/NXWZrn3.png" alt="EITest TSS" class="center" /></p>

<p>This script will, after verifying that it is running  in a real browser, set a cookie named “<strong>popundr</strong>” and redirect the user at a decoy URL, <code class="highlighter-rouge">hxxp://checkalldir.bid/index/?MGjJPm</code> in this case. Decoy domains injected resolve to IP <strong>204.155.28.5</strong>, in a range belonging to KING-SERVERS (AS 14576). Since 2018-02-26, injected domains were resolving to IP <strong>54.36.180.110</strong> at OVH instead (AS16276). It later changed back to <strong>162.244.35.33</strong>, where TSS domains are now pointing.</p>

<p>This EITest campaign is generating ~1 new domain per day (usually with the TLD .bid). Those are easily recognizable by their patterns “<strong>/?{6 characters}</strong>” in the URL, but the pattern is changing about 4 times per day. The reason they are using a decoy URL and a specific pattern is so they can be routed through their Keitaro TDS (traffic distribution system). In fact, we can browse to the panel of this TDS by accessing it with the IP address at URN <strong>/admin</strong>:</p>

<p><img src="https://i.imgur.com/ubrDuCY.png" alt="tds" class="center" /></p>

<p>Routing requests to their TDS before landing on the final destination allows them to have better control of the traffic and manage multiple campaigns. They are also doing more filtering on who will be redirected through this URL. We know that they are verifying at least the user-agent of the requester before allowing any redirection. Here is what will happen when the victims get redirected to one of those domains:</p>

<p><img src="https://i.imgur.com/32udaW5.png" alt="Curl referenz.bid" class="center" /></p>

<p>In this case, querying the decoy EITest URL with an user-agent set to “MSIE” was enough for the TDS to send a 302 redirection to the landing page: <code class="highlighter-rouge">hxxp://coloured-canvas.tk/?number=800-803-1741</code></p>

<h2 id="crypper-redirection">Crypper Redirection</h2>

<p><img src="https://i.imgur.com/r715xB2.jpg" alt="Crypper Redirection" class="center" /></p>

<p>This campaign generates about 165 redirections / hour. Website <code class="highlighter-rouge">luyengame.com</code> was responsible for 904 redirections (68%).</p>

<p>For this redirection, we were able to get our hands on the malicious PHP file that is responsible for the generation of the script that redirects users:</p>

<p><img src="https://i.imgur.com/wl9prP0.png" alt="Crypper code" class="center" /></p>

<p>The PHP code will start by hiding any errors from the output and get the user-agent and referer of the visitor. Prior to the creation of the javascript that will redirect the user, the code checks that the visitor is not a bot (crawler) and that the visitor is not on a mobile device. If those checks pass, it will fetch the current Tech Support Scam (TSS) domain <code class="highlighter-rouge">hxxp://roi777.com/domain.php</code> and append the path “<strong>/index/?2661511868997</strong>” to it.</p>

<p>Finally, the function “<strong>redirectdd</strong>” is called with the created URL and the script will output with the latest domain that <code class="highlighter-rouge">roi777.com</code> provided:</p>

<p><img src="https://i.imgur.com/ZhZRVlM.png" alt="Crypper TSS" class="center" /></p>

<p>The script then sets a cookie “<strong>1561065164894_CRYPPER</strong>” and redirects the user with <strong>window.location</strong>. Although simple, this script is efficient enough to redirect many visitors.</p>

<h2 id="biz-redirection">Biz Redirection</h2>

<p><img src="https://i.imgur.com/zoIK5qq.jpg" alt="Biz Redirection jpeg" class="center" /></p>

<p>This campaign generates about 1888 redirections / hour. Website <code class="highlighter-rouge">myilifestyle.com</code> was responsible for 1199 redirections (8%) and <code class="highlighter-rouge">www.fertilitychef.com</code> for 1091 (7%) of the redirections.</p>

<p>This redirection is distinguishable with the added path to the TSS domain: “<strong>/index/?2171506271081</strong>”.</p>

<p><img src="https://i.imgur.com/G7lfNPK.png" alt="Biz Code" class="center" /></p>

<p>The script will fetch another script from <code class="highlighter-rouge">hxxp://5.45.67.97/1/jquery.js.php</code> and run it, leading to a redirection:</p>

<p><img src="https://i.imgur.com/ROiaKat.png" alt="Biz Redirection png" class="center" /></p>

<h2 id="plugin-redirection">Plugin Redirection</h2>

<p><img src="https://i.imgur.com/H9JjeBT.jpg" alt="Plugin Redirection" class="center" /></p>

<p>This campaign generates about 184 redirections / hour. Website <code class="highlighter-rouge">Archive-s54.info</code>  was responsible for 119 redirections (8%).</p>

<p>This campaign has malicious Javascript slightly obfuscated by using the “reverse string” function:</p>

<p><img src="https://i.imgur.com/YIYBvDd.png" alt="Plugin TSS" class="center" /></p>

<p>There are a few variants of this script containing different URLs. By applying the reverse string function again on the string containing the malicious URL, we were able to identified all of them:</p>
<ul>
  <li>hxxp://kodmax.com/wp-content/plugins/twitter-widget-pro/lib/<INFECTED.PHP></INFECTED.PHP></li>
  <li>hxxp://www.katiatenti.com/wp-content/plugins/sydney-toolbox/inc/<INFECTED.PHP></INFECTED.PHP></li>
  <li>hxxp://emarketing-immobilier.com/wp-content/plugins/gotmls/safe-load/<INFECTED.PHP></INFECTED.PHP></li>
  <li>hxxp://stefanialeto.it/wp-content/plugins/flexible-lightbox/css/<INFECTED.PHP></INFECTED.PHP></li>
</ul>

<p>Once visited, those PHP files will set a cookie and redirect the user to the TSS landing page with the parameter “<strong>/index/?2101505838590</strong>” without further verification:</p>

<p><img src="https://i.imgur.com/3aKQwEO.png" alt="Kodmax redirection" class="center" /></p>

<p>Clearly, those four (4) website redirecting users have been hacked. One of them has the directory listing enabled, allowing us to see that the malicious file has been put there on 2017-11-17. It is probably at this date that this campaign started. Also, as <a href="http://malware-traffic-analysis.net/2018/01/06/index.html">another malware researcher did</a>, we can search for some of the unique constants in the javascript file on Google and find more than 8000 indexed websites that are apparently infected with this script:</p>

<p><img src="https://i.imgur.com/eGxb4aO.png" alt="Google Query" class="center" /></p>

<p>Sometimes, the script gets injected multiple times within a page or in a way that it doesn’t work. For example, this website got defaced with the badly injected javascript:</p>

<p><img src="https://i.imgur.com/Z4ubsSk.png" alt="Basham Radio" class="center" /></p>

<p>We went one step further when we realized that those malicious PHP files redirecting the users were logging every queries received in a .txt file accessible on the same server. For each redirected user, we had the timestamp of the query, their IP address, referrer and their user-agent. We then downloaded the logs for each of those 4 websites to index them in a database. To consider a request unique, we looked at the hash of: The <strong>timestamp</strong> of the request + the victim <strong>IP</strong> + the <strong>referer</strong> domain name.</p>

<p>This allowed us to determine that more than 7400 unique redirections happened since february 20.</p>

<p><img src="https://i.imgur.com/QJI4Zsk.png" alt="chart" class="center" />
Country of redirected users for the ‘Plugin’ redirection</p>

<p>The campaign is still going on so the numbers are constantly increasing. We also looked at unique domains in the referer field. We spotted ~1294 different domains redirected those users. The ones that redirected the most users are:</p>

<ul>
  <li><code class="highlighter-rouge">Revista.academiamaestre.es</code> (5678 redirections)</li>
  <li><code class="highlighter-rouge">admission.covenantuniversity.edu.ng</code> (1947 redirections)</li>
  <li><code class="highlighter-rouge">blog.apartmentfinder.com</code>  (1844 redirections)</li>
  <li><code class="highlighter-rouge">rockthedirt.com</code> (1566 redirections)</li>
</ul>

<h2 id="location-for-expert-redirection">Location For Expert Redirection</h2>
<p>Some website are redirecting users to TSS domains with the following path: “<strong>/index/?1641501770611</strong>”.  It is the result of running this malicious javascript:</p>

<p><img src="https://i.imgur.com/ASZpCeM.png" alt="Expert Redirection" class="center" /></p>

<p>After deobfuscation, the code becomes readable and we can see the redirection:</p>

<p><img src="https://i.imgur.com/vUJ6wp5.png" alt="Expert Redirection 2" class="center" /></p>

<p>The client will query the URL at <code class="highlighter-rouge">hxxp://ads.locationforexpert.com/b.php</code> (the filename often changes). The remote script then returns the URL where the user will be redirected.</p>

<h2 id="containerru-redirection">ContainerRU Redirection</h2>

<p><img src="https://i.imgur.com/C00n1oY.jpg" alt="ContainerRU Redirection" class="center" /></p>

<p>This campaign generates about 335 redirections / hour. Website <code class="highlighter-rouge">www.cursosortografia.com</code> was responsible for 158 redirections (6%) and <code class="highlighter-rouge">cursosaprende.com</code> for 142 redirections (5%).</p>

<p>This Javascript found was obfuscated by hiding the content of the code in a fake image encoded in base64:</p>

<p><img src="https://i.imgur.com/yNPkqol.png" alt="containerRU TSS" class="center" /></p>

<p>After deobfuscation, we can analyse the code:</p>

<p><img src="https://i.imgur.com/Pqmk1VD.png" alt="ContainerRU - deobfuscated" class="center" /></p>

<p>The script will verify If the navigator of the user is either Chrome or Firefox. In this scenario, the user is redirected to an URL serving a payload. If the browser is Internet Explorer, the user will be redirected to the following URL: <code class="highlighter-rouge">hxxp://div-class-container.ru/index5.php</code>, which will in turn redirect the user with an HTTP 301 to the TSS page with the parameter “<strong>/index/?801492446045</strong>”:</p>

<p><img src="https://i.imgur.com/Tb8Q9bl.png" alt="ContaierRU redirection" class="center" /></p>

<p>In all cases, if the domain name of the actual infected website contains “edu”, “gov” or “mil”, the script will not redirect the user. 
The IP address where this redirecting script is hosted (193.201.227.193) <a href="https://blog.sucuri.net/2017/10/cryptominers-on-hacked-sites-part-2.html">has been linked</a> to unwanted redirects in late 2017.</p>

<h2 id="doorways-redirections">Doorways redirections</h2>

<p><em>What is a Doorway?</em></p>

<p>A <a href="https://kb.sucuri.net/malware/signatures/php.spam-seo.doorway-gen.001">doorway script</a> is usually an obfuscated PHP script that can trick search engines crawler to perform black hat SEO by modifying the content of a website to specific combination of keywords. However, the one used in this campaign is pretty advanced and allows the owner to basically do whatever he wants with the infected websites, such as injecting content. We discovered that he will often ‘upgrade’ those doorway scripts to PHP backdoors.</p>

<p>We also saw other prolific campaigns for which we don’t have the redirections scripts. For instance, the one generating the largest amount of traffic (URLs are recognizable with “<strong>/index/?1051496225880</strong>”) has been responsible for 43503 redirections over the 8 hours period (5437 redirections per hour) and represents 40% of the overwall traffic seen:</p>

<p><img src="https://i.imgur.com/FlLX2u1.jpg" alt="Top Campaigns seen" class="center" /></p>

<p>The websites who redirected users for this largest campaign is mostly <code class="highlighter-rouge">archive-s54.info</code> with 18331 redirects, followed by:</p>
<ul>
  <li><code class="highlighter-rouge">sharesix.com</code> (947 redirections)</li>
  <li><code class="highlighter-rouge">www.gowatchfreemovies.to</code> (919 redirections)</li>
  <li><code class="highlighter-rouge">myilifestyle.com</code> (871 redirections)</li>
  <li><code class="highlighter-rouge">www.primewire.ag</code> (862 redirections)</li>
  <li><code class="highlighter-rouge">Sharerepo.com</code> (856 redirections)</li>
  <li><code class="highlighter-rouge">www.fertilitychef.com</code>  (820 redirections)</li>
  <li><code class="highlighter-rouge">Filenuke.com</code> (800 redirections)</li>
</ul>

<p>We believe that those website have the <a href="https://kb.sucuri.net/malware/signatures/php.spam-seo.doorway-gen.001">doorways</a> backdoor installed. Most of them are configured to get to latest TSS URL to :
<code class="highlighter-rouge">hxxp://fped8.org/doorways/settings_v2.php?clientid=&lt;ID&gt;&amp;ineednewurltoredirect=yes</code></p>

<p>This website will return the appropriate domain to redirect the user:</p>

<p><img src="https://i.imgur.com/ubeade1.png" alt="Doorway redirection" class="center" /></p>

<h2 id="other-redirections">Other redirections</h2>
<p>By monitoring the backend servers, we discovered that the same infrastructure also serves for other malicious activities.</p>
<h3 id="chrome-plugin">Chrome plugin</h3>
<p>We’ve also observed some redirections chains from malvertising leading to fake chrome extensions. For example, one customer of <a href="https://www.popads.net/">PopAds</a>, whose account is now banned, was redirecting clients to a TDS system at this URL: <code class="highlighter-rouge">hxxp://162.244.35.210/newantikas/?cP65FB</code>. After multiple redirections, the users landed on the website <code class="highlighter-rouge">livelifeo.top</code>, which resolved to IPs belonging to the back-end server we were monitoring:</p>

<p><img src="https://i.imgur.com/Uimg42b.png" alt="malicious-fake-chrome-addon" class="center" /></p>

<p>After more digging into domains associated to the same scam, we also found another version of the landing page that tried to trick users to those malicious Chrome extensions:</p>

<p><img src="https://i.imgur.com/dccmI5W.png" alt="Chrome Plugin" class="center" /></p>

<p>The back-end server, owned by <strong>Roi777</strong> was also responsible for the traffic generated by those malicious Chrome extensions.</p>

<p>We also found a control panel that allowed them to categorize the status of those applications. Fortunately for us, the developer had no idea how to properly protect this panel. The password verification function was implemented in client-side Javascript.</p>

<p><img src="https://i.imgur.com/IYyxWw0.jpg" alt="Plugin panel" class="center" /></p>

<p>We later found those Chrome extension in the Chrome Store infected and heavily obfuscated. The purpose of them was to randomly redirect the user while browsing. The page where users get redirected can vary from nuisance advertisement to fake software installation page and TSS.</p>

<p>Anyhow, those addons are no longer being pushed and the page is no longer being updated. The actors probably moved to something else.</p>

<h3 id="pinterest">Pinterest</h3>
<p>We also found some links to TSS on Pinterest: 
<code class="highlighter-rouge">jeanclementcom.us</code> has been registered with the email address <strong>opel73rus@gmail.com</strong>, like many other domains name hosted on <strong>Roi777</strong> infrastructure.</p>

<p><img src="https://i.imgur.com/x17uqXo.png" alt="Pinterest" class="center" /></p>

<h3 id="android-applications">Android applications</h3>
<p>Malicious APKs are also found to be served when browsing to a domain hosted on his infrastructure : <code class="highlighter-rouge">fped8.org/mob/antivirus/1/en/index.php</code></p>

<p><img src="https://i.imgur.com/i7OJs7x.png" alt="Virus detected" class="center" /></p>

<p><a href="https://www.virustotal.com/#/file/3cec545922252e0cfc3e0149a63d9df73b0f7f89aa0782a3c7ad16844f804c66/details">The payload</a> is then downloaded from: <code class="highlighter-rouge">fped8.org/mob/antivirus/1/en/downloader.php</code>. Once installed, the application will contact another domain hosted on the same server (<code class="highlighter-rouge">hxxp://alija.xyz/panel/</code>).</p>

<p>This APK has the ability to redirect users to fraudulent ads and potentially TSS.</p>

<h2 id="analysis-of-the-backend-traffic">Analysis of the backend traffic</h2>
<p>By monitoring differents TDS and back-end server serving those TSS campaigns, we saw a lot of different traffic type linked to differents malicious activities.Not only is this actor involved in the selling of fake software and redirecting to scams, but also in severals webshells and doorways backdoors, allowing him to control a vast network of compromised websites. This section take a look at those differents access methods and how they are leveraged.</p>

<h3 id="uses-of-scams-domains">Uses of scams domains</h3>

<p>We observed TSS domains usually having the TLD .TK changing more than 100 times per day for this campaign. In the last 30 days only, we were able to log 2912 of those domains. Here is the most common IPs where they are pointing:</p>

<ul>
  <li>999 of them (35%) are resolving to <strong>204.155.28.5</strong> (King Servers)</li>
  <li>878 of them (30%) are resolving to <strong>185.159.83.47</strong> (King Servers)</li>
  <li>162 of them (5%) are resolving to  <strong>54.36.151.52</strong> (OVH)</li>
</ul>

<h3 id="php-backdoor">PHP Backdoor</h3>
<p>We discovered that many “bots” were reporting to the back-end server belonging to <strong>Roi777</strong>. In fact we account for a total of 1562 infected websites reporting to his server. There are two types of backdoors that report to the infrastructure we monitored.</p>

<p>The first one being <a href="https://kb.sucuri.net/malware/signatures/php.hacktool.doorway-gen.001">Doorways</a>.We counted 386 differents website constantly asking the server for content to inject.</p>

<p>For the other type of backdoor, we observed 1176 differents domains infected reporting to the server, also asking for content to inject. Here is some stats about the CMS they used:</p>
<ul>
  <li>WordPress : 211</li>
  <li>OpenCart: 41</li>
  <li>Joomla: 19</li>
  <li>Magento: 1</li>
  <li>Unknown: 904</li>
</ul>

<p>This backdoor is described in the next section.</p>

<h3 id="doorways-to-php-backdoor">Doorways to PHP backdoor</h3>
<p>The Doorways have the capability to fetch for instruction and code to execute. We noticed that many of them were querying <code class="highlighter-rouge">fped8.org/doorways/settings_v2.php</code>. This URL, when queried with the good parameters, returns code to execute. This allowed us to saw how they can deploy PHP shell through their Doorways:</p>

<p><img src="https://i.imgur.com/Y9ISbDW.png" alt="doorways_to_php" class="center" /></p>

<p>The content returned contains the backdoor encoded in base64, rot13 and base64 again. After de-obfuscation, we got this code:</p>

<p><img src="https://i.imgur.com/E3xjKnG.png" alt="shell" class="center" /></p>

<p>The first part of this malicious PHP script will query <code class="highlighter-rouge">hxxp://kost8med.org/get.php</code> with the user-agent of the current visitor requesting the page and it’s IP address. If a content is returned, it will be outputted in the content of the page. That said, the owner of the backdoor can inject any code they want into the page. Again, <code class="highlighter-rouge">kost8med.org</code> is resolving to <strong>162.244.35.30</strong> which is an IP address belonging to <strong>Roi777</strong>.</p>

<p>The second part of the script contains a backdoor function executing every request received in the “c” field of the POST parameter of the request if the parameter “p” is also set with the correct password.</p>

<p>The password validation is done in a strange way. The received parameter “p” will be hashed twice before being compared to the hardcoded MD5 hash. However both the idea and the implementation is deficient here, because hashing twice is not more secure in this situation and the comparison is done with “==” instead of “===” (strict comparison), plus the fact that MD5 is no longer considered secure.</p>

<p><img src="https://media.giphy.com/media/TEmi096kezejdtyAjT/giphy.gif" alt="giphy.gif" class="center" /></p>

<p>It took less than 30 mins to crack the actual password allowing the control of those backdoors. We must say that the speciality of those guys is clearly not security, but rather the opposite.</p>

<p>On a Wordpress installation, this backdoor is usually found in those files:</p>
<ul>
  <li>wp-config.php</li>
  <li>index.php</li>
  <li>wp-blog-header.php</li>
  <li>Footer.php</li>
</ul>

<p>We also found what looks like the administrator panel on the same server that they are reporting to:</p>

<p><img src="https://i.imgur.com/vhWVF6U.png" alt="panel" class="center" /></p>

<h3 id="other-backdoors">Other backdoors</h3>
<p>Many of the websites that were infected by the original backdoor we were investigating on were also infected with other PHP malicious scripts. However, we don’t think those other scripts were linked to this campaign.</p>

<h3 id="infection-vector-plugin-that-is-hacked-infected-path">Infection vector (plugin that is hacked, infected path)</h3>

<p>It is hard to know for sure how those CMS has been infected. One thing we did notice on lot of them is that the malicious code was in the file <strong>footer.php</strong> of a WordPress plugins named Genesis. It turns out that this plugin was <a href="https://www.pluginvulnerabilities.com/2016/09/22/arbitrary-file-upload-vulnerability-in-genesis-simple-defaults/">known to be vulnerable</a> against Arbitrary File Upload in late 2016. However a lot of them have been exploited by other means, such as with other vulnerable plugins and passwords stealings / brute forcing.</p>

<h2 id="redirecting-the-traffic-flow-or-dethroning-the-king">Redirecting the traffic flow (or dethroning the king)</h2>
<p>By looking at requests sent to the back-end servers, we noticed curious GET requests among a the traffic. The GET requests in question were formatted like the following : 
<code class="highlighter-rouge">hxxps://wowbelieves.us/tech_supportv2.php?update_domain=&lt;Tech support Scam domain&gt;</code></p>

<p>The <strong>update_domain</strong> parameter immediately drew our attention, so we tried to do a query to the same PHP file with a domain under our control as the value of this parameter. Immediately, our server started receiving traffic.</p>

<p><img src="https://i.imgur.com/ckvCa8p.jpg" alt="image" class="center" /></p>

<p>So apparently, calls to this PHP file change to current domain published for TSS that the backdoors are relying on to redirect the users. In fact, we were able to change the domain  returned by <code class="highlighter-rouge">roi777.com/domain.php</code>, where multiple backdoors are fetching the current TSS domain. As said before, those domains are changing more than 100 times a day, and we observed that they have a script calling <strong>/tech_supportv2.php</strong> frequently so users can be redirected to the latest domain. That said, when we changed the TSS domain to point to a domain under our control, it took only few minutes before their script updated it with the real TSS, overwriting ours at the same time. To keep the traffic going to our server, we then had to query multiple time per minute this webpage, and it sure worked.</p>

<p>After the initial 8 hours in which we had control of most of the traffic, they updated <strong><em>tech_supportv2.php</em></strong> and their script calling it so that the parameters expect were now the domain name to update, plus a key: 
<code class="highlighter-rouge">hxxps://wowbelieves.us/tech_supportv2.php?update_domain=&lt;Tech support Scam domain&gt;&amp;key=&lt;Hash MD5&gt;</code></p>

<p>To fix the aberrant lack of security in their mechanism to update the current TSS domains, they added this key to the parameters so our previous requests weren’t working anymore.</p>

<p><img src="https://i.imgur.com/BYcu3rv.jpg" alt="playgame" class="center" /></p>

<p><em>What is this ‘key’ parameter ?</em></p>

<p>The key parameter was 32 characters long, so we immediately thought of an MD5 hash. We tried to hash the current domain to see if it was matching, but no luck. We also noticed that the ‘key’ value (or hash) was different for each TSS domain they were updating and we were able replay them without problem. Given this information, it looked like it they were probably using some sort of salting with the domain name before hashing it.</p>

<p>Knowing a part of the hashed value (the domain name), and giving their expertise in cryptography, we started a <a href="https://hashcat.net/wiki/doku.php?id=mask_attack">mask attack</a> locally with hashcat. It took us less than 10 seconds to reveal the salt used. The MD5 hash was the result of the domain name concatenated to the string: “<strong>ropl</strong>”. This allowed us to take the control back (on and off) of the traffic for another 7 hours. However, the stats used above for webshells and redirections are only based on the first 8 hours of collection.</p>

<p><img src="https://i.imgur.com/Zz2lBdZ.jpg" alt="captain" class="center" /></p>

<p>Note that we didn’t take advantage of the redirected traffic, we instead logged every request made and temporarily neutralized the campaigns by avoiding any redirections to malicious websites.</p>

<p>The first time we redirected the traffic, we collected more than 108700 requests (8 hours period). 
The second attempt to redirect the traffic allowed us to log more than 55000 requests (6 hours).</p>

<p>By combining both data sets, we did some statistics:</p>

<p><img src="https://i.imgur.com/IJka9gV.png" alt="chart2" class="center" /></p>

<p>Every request made by IP <strong>89.108.105.13</strong> (Russia) was excluded from the graph because it generated by itself 48256 requests to <strong>/index/api.php</strong> and we believe that this traffic is generated by one of their server that control doorways on their infrastructure.</p>

<p>Here are the top 15 most seen websites in the referer field (probably infected websites):</p>

<p><img src="https://i.imgur.com/IVN8g6O.png" alt="domainstats" class="center" /></p>

<p>Here are the most seen user-agents in those requests:</p>

<p><img src="https://i.imgur.com/pL88qqf.png" alt="uastats" class="center" /></p>

<p>It’s interesting to note that a lot of requests were coming from <a href="https://kodi.tv/">Kodi</a> (Open Source Home Theater Software), followed by Internet Explorer browser.</p>

<h2 id="link-to-roi777">Link to Roi777</h2>
<p>Considering the variety of coding styles, providers, IPs used and infected websites, we believe that many actors are involved in the traffic redirection. However, it is clear that the one known as <strong>roi777</strong> has a central role in this whole scheme. As advertised on his website, he’s buying any type of traffic after all.</p>

<p><em>How does all of that links to Roi777 ?</em></p>

<p>Redirections chains explained above will not always redirect users to TSS. In fact, they are often filtering clients base on GeoIP and user-agent. When the traffic is unwanted for TSS, the redirection chain will often lead to : <code class="highlighter-rouge">hxxp://balans.shahterworld.org</code>.</p>

<p>The parameters passed to those requests is another indication that this campaign is lead by <strong><em>roi777</em></strong>: <br />
<code class="highlighter-rouge">hxxp://balans.shahterworld.org/?utm_medium=4c23b9fecf7dfd895dfe0da99e857f3bee8e9d42&amp;utm_campaign=roi777_cloack</code></p>

<p>Also, almost all of the redirections scripts are either pointing directly to <code class="highlighter-rouge">roi777.com/domain.php</code> to fetch the latest domain or they are reporting to this same backend server, waiting for instruction.</p>

<p>We found an interesting discussion that happened on 06-01-2018 on this Russian forum[^1] involving the owner of the company <strong>Roi777</strong> (using the nickname <em>bagussusu</em>) and another actor (<em>azuluk</em>) providing him backdoors, doorways and other elements mean to increase the number of redirected users. You can read the <a href="http://malware.dontneedcoffee.com/images/blog/hosted/kotd/Russian Forum.pdf">translated conversation here</a>. In summary, we can learn that :</p>
<ul>
  <li>They were involved in the traffic generated by some Chrome Extension</li>
  <li>They are using Quiwi / WebMoney financial services to transfer money.</li>
  <li>Their main offer is currently Tech Support Scam.</li>
  <li><em>Bagussusu</em> is accepting a minimum trade of 1000 webshells and can convert them to Doorways</li>
  <li><em>Azuluk</em> had 30GB of mail accounts+passwords ready to sell. 5 millions of those were corporate accounts</li>
  <li><em>Bagussusu</em> is also using SPAM to increase the traffic.</li>
  <li><em>Bagussusu</em> have some employees working for him (developers).</li>
  <li>The return on investment is apparently better in France (people get scammed easier).</li>
  <li><em>Azuluk</em> is using <a href="http://jako.tech">JakoDorgen</a> to create Doorways.</li>
  <li>
    <p><em>Bagussusu</em> recommands to fetch the latest TSS domain to his website with this PHP code:</p>

    <p><code class="highlighter-rouge">$domain = file_get_contents('http://roi777.com/domain.php');</code></p>
  </li>
  <li>They also provide other interesting details such as the IP of the TDS</li>
</ul>

<h2 id="who-is-this-roi777-">Who is this “Roi777” ?</h2>
<p>Being a young adult living in Russia, you can also find him using the following identities:</p>
<ul>
  <li>https://t.me/roi777Eng</li>
  <li>Tipatop</li>
  <li>ICQ #: 660-349-155</li>
  <li>ICQ #: 380-046-929</li>
  <li>Skype: live: compiknews</li>
  <li>Jabber: BagusSusu@exploit.im</li>
  <li>Telegram: @roi777Ru</li>
  <li>compiknews@gmail.com</li>
  <li>SocMaster</li>
</ul>

<p>This non-exhaustive list is some of the most common pseudonyms he uses online. He operates a company that does “Traffic Monetization”. We now know how this traffic is brought back to his network (by illegals means) and what it is for (fraud).</p>

<h2 id="roi777-website">Roi777 Website</h2>
<p>His official website advertises some Success stories !</p>

<p><img src="https://i.imgur.com/FpEJfaW.png" alt="Traffic Monetization" class="center" />
Success stories include traffic generated by Doorways</p>

<p>And there’s also a Keitaro TDS installed directly on <strong>/tds/</strong>:</p>

<p><img src="https://i.imgur.com/Us8LQCM.png" alt="Keitaro TDS" class="center" /></p>

<h2 id="iocs">IOCs:</h2>
<p>Most of the domains for domains used for scams are being resolved by <code class="highlighter-rouge">ns1.rakamakao.org</code> and <code class="highlighter-rouge">ns2.rakamakao.org</code> (195.245.113.186 &amp; 195.245.113.187). The PowerAdmin administration tool they are using is accessible on the same servers:</p>

<p><img src="https://i.imgur.com/lW9vHIm.png" alt="poweradmin" class="center" /></p>

<table>
  <thead>
    <tr>
      <th>Some of the domains:</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">alija.xyz</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">fped8.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">wowbelieves.us</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">shahterworld.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">roi777.com</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">kost8med.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">picturesun.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">websun.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">apelsinnik.site</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">chooseok.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">anyads.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">49frankov.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">africangirlskillingit.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">africanprint.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">africanpygmyhedgehog.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">africanamerican.top</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">arbuz01.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ava4.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">jessica1.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">crispyom.org</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">kir2great.us</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">selenapix.us</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">wowbirth.us</code></td>
    </tr>
  </tbody>
</table>

<p>Also,  AS14576 <a href="https://threatreconblog.com/2017/02/05/kings-and-secrets-not-a-good-combo/">Bullet proof hoster: King Servers</a> doesn’t seems to host any legitimate services except of cyber-crime on their infrastructure.</p>

<table>
  <thead>
    <tr>
      <th>IPs:</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">204.155.28.5</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">54.36.180.110</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">54.36.151.52</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">89.108.105.13</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">185.159.83.48</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">185.159.83.47</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">190.2.132.198</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.34.20</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.21</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.30</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.33</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.35</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.36</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.54</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.55</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">162.244.35.234</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">195.245.113.187</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">195.245.113.186</code></td>
    </tr>
  </tbody>
</table>

<h2 id="conclusion">Conclusion</h2>
<p>By distributing fake applications, using underground malware distribution campaigns, and leveraging malvertisements, the actors behind the company <strong>Roi777</strong> are trying to get as much traffic as they can, by any means possible. They are well active and always willing to get more traffic redirected to their scams so they can increase their income.</p>

<p>The EITest campaign, in part responsible for the TSS redirections, is still active even if it is one of the oldest campaign running and the backend servers IP have previous been revealed.</p>

<p>[^1]https[://forum.exploit[.in/index.php?act=ST&amp;f=75&amp;t=134802&amp;st=0)</p>

		</article>
	</div><!-- /.medium-12.columns -->
</div><!-- /.row -->




	
	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" href="#top-of-page">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->


    <footer id="footer-content" class="bg-grau">
      <div id="footer">
        <div class="row">
          <div class="medium-6 large-5 columns">
            <h5 class="shadow-black"></h5>

            <p class="shadow-black">
              Sleep is a symptom of caffeine deprivation.
            </p>
          </div><!-- /.large-6.columns -->


          <div class="small-6 medium-3 large-3 large-offset-1 columns">
            
              
                <h5 class="shadow-black">Services</h5>
              
            
              
            
              
            
              
            
              
            

              <ul class="no-bullet shadow-black">
              
                
                  <li >
                    <a href="http://192.168.168.203:4000"  title=""></a>
                  </li>
              
                
                  <li >
                    <a href="http://192.168.168.203:4000/contact/"  title="Contact">Contact</a>
                  </li>
              
                
                  <li >
                    <a href="http://192.168.168.203:4000/feed.xml"  title="Subscribe to RSS Feed">RSS</a>
                  </li>
              
                
                  <li >
                    <a href="http://192.168.168.203:4000/atom.xml"  title="Subscribe to Atom Feed">Atom</a>
                  </li>
              
                
                  <li >
                    <a href="http://192.168.168.203:4000/sitemap.xml"  title="Sitemap for Google Webmaster Tools">sitemap.xml</a>
                  </li>
              
              </ul>
          </div><!-- /.large-4.columns -->


          <div class="small-6 medium-3 large-3 columns">
            
              
                <h5 class="shadow-black">Merci</h5>
              
            
              
            
              
            

            <ul class="no-bullet shadow-black">
            
              
                <li >
                  <a href="http://192.168.168.203:4000"  title=""></a>
                </li>
            
              
                <li class="network-misp" >
                  <a href="https://www.misp-project.org/" target="_blank"  title="MISP Project - Open Source Threat Intelligence Platform & Open Standards For Threat Information Sharing">MISP</a>
                </li>
            
              
                <li class="network-cuckoo" >
                  <a href="https://cuckoosandbox.org/" target="_blank"  title="Automate Malware Analysis">Cuckoo</a>
                </li>
            
            </ul>
          </div><!-- /.large-3.columns -->
        </div><!-- /.row -->

      </div><!-- /#footer -->


      <div id="subfooter">
        <nav class="row">
          <section id="subfooter-left" class="small-12 medium-6 columns credits">
            
          </section>

          <section id="subfooter-right" class="small-12 medium-6 columns">
            <ul class="inline-list social-icons">
            
              <li><a href="http://github.com/Kafeine" target="_blank" class="icon-github" title="Code and more..."></a></li>
            
              <li><a href="http://twitter.com/Kafeine" target="_blank" class="icon-twitter" title="Last tweets"></a></li>
            
            </ul>
          </section>
        </nav>
      </div><!-- /#subfooter -->
    </footer>

	

	


<script src="http://192.168.168.203:4000/assets/js/javascript.min.js"></script>














</body>
</html>


<div style="text-align: center;"><a href="http://1.bp.blogspot.com/-c5LwFfgffI0/VnPoBn99MlI/AAAAAAAAFYU/lGPqkI3CO9k/s1600/2015-12-18_12h03_29.png" imageanchor="1"><img border="0" height="105" src="http://1.bp.blogspot.com/-c5LwFfgffI0/VnPoBn99MlI/AAAAAAAAFYU/lGPqkI3CO9k/s200/2015-12-18_12h03_29.png" width="200" /></a></div><br /><br />One year since I started "active" actions in understanding what is on the other side of malware/mass infection campaign. Will share in one picture how i figure things.<br /><i><span style="font-size: x-small;">&nbsp;( I hope to have many feedback to fix/adjust my understanding )</span></i><br /><br />I will focus on the <span style="color: #351c75;">Ransomware</span> case but most parts are valid for many other "blind mass attack" (as Ransomware is a specific case of Botnet<span style="font-size: x-small;">&nbsp;</span>)<br /><br />Straight to the visual :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-UUxPMUNI1kY/VnPnhvDKLAI/AAAAAAAAFYI/iaX-sJMUcns/s1600/rendu2.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="360" src="http://2.bp.blogspot.com/-UUxPMUNI1kY/VnPnhvDKLAI/AAAAAAAAFYI/iaX-sJMUcns/s640/rendu2.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><div style="font-size: 12.8px;">Eye glance at the first line of "Russian Underground"</div><div style="font-size: 12.8px;">The path to infection&nbsp;</div><div style="font-size: 12.8px;"><a href="http://pastebin.com/HsugYbhL">Credits</a>&nbsp;for some models used here</div><div style="font-size: 12.8px;"><span style="font-size: xx-small;">Note: New infection vector appeared in early 2013 - RDP compromission then Crypto Ransomware</span></div></td></tr></tbody></table><br />And now here are basic explanation to read the illustration (even if most of you don't need it :P ).<br />I won't talk about what happen after infection (data/voucher code reselling, money laundering, etc...). It's another story.<br /><br />&nbsp;<span style="font-size: x-small;"><i>(will try to add here a table of content or list of anchor links)</i></span><br /><!-- -Poke A Mole Concept (redirectors and domain rotations) -Infection vectors   -Browsing   -Chat/mail   -manual download -Malvertising -Redirection Infrastructure -Traffic Exchange Plateform -Domain Rotator System -Exploit Kits -A binary life -Underground Forums --> <br /><h3>-Poke A Mole Concept</h3>I will first talk about a concept to which i will often refer, the forest hiding the tree, or the "Poke A Mole board".<br />On previous map, most of the steps are represented by a single node but even small groups will hide the real node/bad server behind redirectors/reverse proxies. It's easier to recreate a redirector than rebuild a new server once a node is burnt (read: blacklisted by browser internal protections or antivirus or other filtering tools).<br />The smallest group will have one server and multiple IP, then we'll see some groups with one server and one redirector with multiple IPs, and bigger groups can daily add many redirectors.<br /><br />This is how you can reach this kind of architecture for a single exploit kit :<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://3.bp.blogspot.com/-2xKOU25Nl4s/UHveo2umhCI/AAAAAAAAB04/Jt61UDLbZ_w/s1600/Cool+EK+PokeAMole+Board+-+13-10-2012_resize3.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="362" src="http://3.bp.blogspot.com/-2xKOU25Nl4s/UHveo2umhCI/AAAAAAAAB04/Jt61UDLbZ_w/s640/Cool+EK+PokeAMole+Board+-+13-10-2012_resize3.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 13px;">Cool EK Poke A Mole Board (Snapshot as <a href="http://malware.dontneedcoffee.com/2012/10/newcoolek.html">I saw it</a> on 13/10/2012)<br />Too small ? :&nbsp;<a href="http://i.minus.com/ibbdTxd1LpqqHr.jpg">http://i.minus.com/ibbdTxd1LpqqHr.jpg</a></td></tr></tbody></table><br />or even bigger ( <a href="http://malware.dontneedcoffee.com/2012/09/ULockerAS36444BHEK.html">I saw one Blackhole with up to 2400 ips</a> available to reach it...at least 1940 when it was also hosting a Ransomware C&amp;C)<br /><br />Same goes for Domains. Having hundreds of domain allow bad guy to switch from one to another and escape domain based blacklisting. Managing domain generation/rotation can be manual, "outsourced", built-in the tools or managed by dedicated tools. I'll give more details later.<br /><br />One other great illustration for both, was back in february/march 2012, the Sinowal/Torpig group hosting its custom Blackhole on infected nodes of its botnet and making it reachable via Fast-Flux &amp;&amp; DGA (based on Twitter trends).<br /><br /><h3>-Infection vector :</h3>this is how you get infected (as I focus on <i><span style="color: #351c75;">Ransomware</span></i>, I won't talk about USB/Network Share etc..<br />&lt;edit 2013-03-25&gt; Some crypto-ransomware are now deployed after RDP compromission. Bruteforce on windows server and Via Remote Desktop Protocol. &lt;/edit&gt;<br /><br /><h4>&nbsp;- Browsing Website :</h4><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-EiyoBEzByZA/UL5uYKSYJRI/AAAAAAAADNc/ljq6Csm0Alw/s1600/2_Infection.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="149" src="http://3.bp.blogspot.com/-EiyoBEzByZA/UL5uYKSYJRI/AAAAAAAADNc/ljq6Csm0Alw/s320/2_Infection.jpg" width="320" /></a></div><br />&nbsp; &nbsp;- Compromised website : one website has been compromised either using a vulnerability (usually on outdated CMS) or using stolen credentials from owner, modified to redirect visitors to the infection.<br />There are a lot dedicated tools to manage a huge amount of iFrame on website with known credentials or kown vulns<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-vEVSdaG7jJc/UL89PDrN3fI/AAAAAAAADdg/t3SLPLgJ3gc/s1600/screenshot_105.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a><a href="http://3.bp.blogspot.com/-vEVSdaG7jJc/UL89PDrN3fI/AAAAAAAADdg/t3SLPLgJ3gc/s1600/screenshot_105.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-vEVSdaG7jJc/UL89PDrN3fI/AAAAAAAADdg/t3SLPLgJ3gc/s320/screenshot_105.png" width="232" /></a></div><a href="http://3.bp.blogspot.com/-EC3A8Da3c9U/UL89y7uVhpI/AAAAAAAADdo/m7ZKEa32iG0/s1600/screenshot_1287.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em; text-align: center;"><img border="0" height="234" src="http://3.bp.blogspot.com/-EC3A8Da3c9U/UL89y7uVhpI/AAAAAAAADdo/m7ZKEa32iG0/s320/screenshot_1287.png" width="320" /></a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-EC3A8Da3c9U/UL89y7uVhpI/AAAAAAAADdo/m7ZKEa32iG0/s1600/screenshot_1287.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a></div>&nbsp; - Malvertising : same via a malicious fake advert (see advertising platforms)<br /><br /><br /><h4>&nbsp; - Chat/mail</h4><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-JdqSlxeMtsQ/UL5uhn1NxaI/AAAAAAAADNk/kviKRiNY8P0/s1600/2Social4.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="149" src="http://1.bp.blogspot.com/-JdqSlxeMtsQ/UL5uhn1NxaI/AAAAAAAADNk/kviKRiNY8P0/s320/2Social4.jpg" width="320" /></a></div>&nbsp; &nbsp; - link to compromised website or exploit kit<br />&nbsp; &nbsp; - binary as attachement, or document with link to the exploit kit<br /><br /><i><span style="color: #351c75; font-size: x-small;">( Matsnu/Rannoh mainly spread by mail, and skype<a href="http://www.gfi.com/blog/skype-users-targeted-with-ransomware-and-click-fraud/"> was used to redirect</a> users to BH EK 2.0 then Ransomware )</span></i><br /><br /><br /><br /><br /><br />The tools :<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://3.bp.blogspot.com/-EhVWvSs2ZvQ/UL9ABaA_SeI/AAAAAAAADdw/1IJ5GJqXOho/s1600/screenshot_110.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="320" src="http://3.bp.blogspot.com/-EhVWvSs2ZvQ/UL9ABaA_SeI/AAAAAAAADdw/1IJ5GJqXOho/s320/screenshot_110.png" width="236" /></a></td></tr><tr><td class="tr-caption" style="font-size: 13px;">A Nacha/Facebook themed spam Tool<br /><div><br /></div></td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-FQF0-U0g6LA/UL9AJiDH3RI/AAAAAAAADd4/middt0dL2-s/s1600/screenshot_106.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="177" src="http://4.bp.blogspot.com/-FQF0-U0g6LA/UL9AJiDH3RI/AAAAAAAADd4/middt0dL2-s/s320/screenshot_106.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">One more mailer</td></tr></tbody></table><div><br /></div><div>To figure out more about that you can read:</div><div><a href="http://tools.cisco.com/security/center/threatOutbreak.x?i=77">Threat Outbreak Alerts</a>&nbsp;(Cisco)</div><div><a href="http://blog.dynamoo.com/">Dynamoo's Blog</a></div><div><br /></div><h4>&nbsp; &nbsp;- Manual download</h4><div>&nbsp; &nbsp; - the victims download the binary by themselves thinking it's something else (a "free" version of a paid game, an indispensable video plugin, a&nbsp;disinfection&nbsp;tool, etc...)</div><div><br /></div><h4>&nbsp; &nbsp;- Push in botnet</h4><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-boPsA3z8ixI/UL51KEU1GXI/AAAAAAAADPE/vVLQV_to3gA/s1600/5_C&amp;C2.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="149" src="http://2.bp.blogspot.com/-boPsA3z8ixI/UL51KEU1GXI/AAAAAAAADPE/vVLQV_to3gA/s320/5_C&amp;C2.jpg" width="320" /></a></div><div>Not a "real" one as it's in fact an&nbsp;already infected&nbsp;computer which is being pushed another malware. (<span style="color: #351c75;"><i> See for instance <a href="http://malware.dontneedcoffee.com/2012/09/from-sakura-to-reveton-via-smoke-bot-or.html">Reveton pushed in a Smokebot</a>. I saw also&nbsp;<a href="http://malware.dontneedcoffee.com/2012/11/inside-view-of-lyposit-aka-for-its.html">Lyposit</a>, Vicas, <a href="http://malware.dontneedcoffee.com/2012/09/urausy-is-invading-europe-targeting-3.html">Urausy</a> pushed that way</i></span>&nbsp;)&nbsp;.<br /><br /></div><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;">Tools : Task option of most Botnet C&amp;C panel</span><br /><span style="font-weight: normal;"><br /></span>In Upas:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-sfNaKWyQ-Ow/UL9DxA8P2LI/AAAAAAAADfY/N9SN7gZNArY/s1600/screenshot_112.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="42" src="http://4.bp.blogspot.com/-sfNaKWyQ-Ow/UL9DxA8P2LI/AAAAAAAADfY/N9SN7gZNArY/s640/screenshot_112.png" width="640" /></a></div><br />In Zemra :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Bp0_wT3izW4/UL9FAUjqz9I/AAAAAAAADfo/61ueuTwveqI/s1600/screenshot_114.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="112" src="http://3.bp.blogspot.com/-Bp0_wT3izW4/UL9FAUjqz9I/AAAAAAAADfo/61ueuTwveqI/s640/screenshot_114.png" width="640" /></a></div><br /><br />In Andromeda :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-AKMR49gf258/UL9EcOlIT5I/AAAAAAAADfg/moSARNWLjFE/s1600/screenshot_113.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="48" src="http://3.bp.blogspot.com/-AKMR49gf258/UL9EcOlIT5I/AAAAAAAADfg/moSARNWLjFE/s640/screenshot_113.png" width="640" /></a></div><br />etc...<br /><h3>Advertising Platforms</h3><div>The&nbsp;platform&nbsp;can be&nbsp;legit&nbsp;or not. Clicksor, Plugrush, Adfly are often being victims of these kind of badvertisers. Some platform are built for that dark job. Malekal pointed a fake platform &nbsp;<a href="http://www.malekal.com/2012/11/20/en-megoads-fake-advertising-for-porn-websites/">in this&nbsp;brilliant&nbsp;post</a> about MegoADS</div><br />These platforms are used or abused by bad guys to push&nbsp;advertisement&nbsp;that will drive the user to the redirection infrastructure, often for instance fake porn website (see later).<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-aSav6YM7HWc/UL9GenJEK5I/AAAAAAAADfw/u1ATjMQtTP4/s1600/screenshot_115.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-aSav6YM7HWc/UL9GenJEK5I/AAAAAAAADfw/u1ATjMQtTP4/s1600/screenshot_115.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Malvert redirecting to "Sibhost" EK which is pushing Urausy</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-3ukuQNN99Uc/UL9HhbYo1RI/AAAAAAAADf4/abF4fpscS4k/s1600/screenshot_117.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-3ukuQNN99Uc/UL9HhbYo1RI/AAAAAAAADf4/abF4fpscS4k/s1600/screenshot_117.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Cbeplay.P pushed by Sweet Orange via TrafficBroker Malvert</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-9MpH-QY5APU/UL9INKlvE_I/AAAAAAAADgA/0KA5UIgz5I8/s1600/screenshot_118.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-9MpH-QY5APU/UL9INKlvE_I/AAAAAAAADgA/0KA5UIgz5I8/s1600/screenshot_118.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">BH EK 2.0 landing after tilt on malvert</td></tr></tbody></table>Tools:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-Onr3YtHo_nU/UL9JVqHKRJI/AAAAAAAADgI/bxPfd69J0co/s1600/screenshot_119.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="263" src="http://2.bp.blogspot.com/-Onr3YtHo_nU/UL9JVqHKRJI/AAAAAAAADgI/bxPfd69J0co/s320/screenshot_119.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Account on legit platform TrafficHolder</td></tr></tbody></table>If you want to learn more about malvertising you should follow <a href="https://twitter.com/malekal_morte">Malekal</a>'s Job.<br />Some readings :<br /><a href="http://www.symantec.com/connect/blogs/malvertising-and-dynamic-dns-never-ending-story">Malvertising and Dynamic DNS: A Never Ending Story</a> - 2013-02-08 - Abhinav Singh&nbsp;- Symantec<br /><a href="http://www.f-secure.com/weblog/archives/00002468.html">Finnish Website Attack via Rogue Ad</a>&nbsp;- 2012-12-05 - Sean - F-Secure<br /><a href="http://googleblog.blogspot.fr/2012/06/ads-integrity-alliance-working-together.html">Ads Integrity Alliance: Working together to fight bad ads</a>&nbsp;- 2012-06-14 - Google Official Blog<br /><a href="http://malware.dontneedcoffee.com/2014/01/grandclix-clicksor-traffic-reseller.html">Grandclix - a Clicksor Traffic Reseller...</a>&nbsp;- 2014-01-27<br /><h3>Redirection infrastructure :</h3><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-VkncD1vDBBA/UL51bEW80XI/AAAAAAAADPM/NaBQ71CxRwg/s1600/3_TDS_Traff.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="149" src="http://4.bp.blogspot.com/-VkncD1vDBBA/UL51bEW80XI/AAAAAAAADPM/NaBQ71CxRwg/s320/3_TDS_Traff.jpg" width="320" /></a></div>This block cover all the steps between the first redirection to the exploitation. This is the "Traffer Zone".<br />Depending on how many actors are involved/how mature are the groups you can see a huge amount of hops.<br /><br /><br />The first step after malvertising is TDS or fake website with redirect js<br /><br />Tools:<br /><br />When modifying a saved legit page is not enough to build a fake site, there are dedicated tools to do this.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-Z3qTuLdr52I/UL5zlhIoRTI/AAAAAAAADO8/uPEdcibyrxI/s1600/Image.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="160" src="http://3.bp.blogspot.com/-Z3qTuLdr52I/UL5zlhIoRTI/AAAAAAAADO8/uPEdcibyrxI/s640/Image.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Initial advert for FakeMaker</td></tr></tbody></table><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="http://i.minus.com/iBYkanzo5vVsu.gif" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://i.minus.com/iBYkanzo5vVsu.gif" height="360" width="640" /></a></td></tr><tr><td class="tr-caption" style="font-size: 13px;">Fakemaker (one fake website builder)</td></tr></tbody></table>(more here : &nbsp;<a href="http://kafeine.minus.com/lsInqkPcgjHSY">http://kafeine.minus.com/lsInqkPcgjHSY</a>&nbsp;)<br /><br />In some case the fake website is used to "prepare" the victim. For instance to increase&nbsp;conversion&nbsp;rate&nbsp;(people paying among infected people)&nbsp;on ransomware some traffer do not hesitate to redirect you to a fake Child porn website (but with real images). Victim shocked before being presented a pseudo law enforcement warning.<br /><br />Dedicated TDS. Those TDS can be hidden behind forest of redirectors/reverse proxies.<br />They are redirecting traffic based on country/browser depending on the needs (client requests).<br />One TDS will often serve different exploit kits depending on the countries/sources of people&nbsp;hitting&nbsp;it.<br /><div><br /></div>Sutra,<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-S4yWsSsWO_k/UL56F95M7kI/AAAAAAAADQk/wD9bkVfX_6o/s1600/screenshot_39.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="482" src="http://2.bp.blogspot.com/-S4yWsSsWO_k/UL56F95M7kI/AAAAAAAADQk/wD9bkVfX_6o/s640/screenshot_39.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">1 TDS many Exploit Kits (at least 5 )<br />For instance a French landing here will be redirected to the default page.</td></tr></tbody></table><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-GCnHd8nwMQs/UL6SKOHl8eI/AAAAAAAADTc/OMB8U4CFTbg/s1600/screenshot_91.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="122" src="http://3.bp.blogspot.com/-GCnHd8nwMQs/UL6SKOHl8eI/AAAAAAAADTc/OMB8U4CFTbg/s640/screenshot_91.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Sutra driving IT Chrome user to a server faking Chrome Update<br />(the server is in fact also a Blackhole Exploit Kit and Pony C&amp;C redirector )</td></tr></tbody></table>Keitaro :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-DlEugK3WauU/UL5_3mTtBHI/AAAAAAAADR8/4jKOtwdK1ag/s1600/screenshot_90.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="362" src="http://4.bp.blogspot.com/-DlEugK3WauU/UL5_3mTtBHI/AAAAAAAADR8/4jKOtwdK1ag/s640/screenshot_90.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Keitaro - Traffic page</td></tr></tbody></table><br /><br />SimpleTDS<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-WZKncba-RtE/UL6AVKJqm-I/AAAAAAAADSE/BH7Hs4_heqE/s1600/screenshot_1059.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="64" src="http://2.bp.blogspot.com/-WZKncba-RtE/UL6AVKJqm-I/AAAAAAAADSE/BH7Hs4_heqE/s640/screenshot_1059.png" width="640" /></a></div><br /><br />sTDS 2.0 MOD JackSoft (a simple TDS modification) :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i4.minus.com/iAmF8MV5C7vgH.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i4.minus.com/iAmF8MV5C7vgH.png" height="640" width="440" /></a></div><br /><br />Other tool : Traffic Shop Analyzer the father of Ninja-TDS<br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://i2.minus.com/i1QD0wSqnCMMf.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="http://i2.minus.com/i1QD0wSqnCMMf.png" height="301" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Traffic Shop Analyzer v3.2 lite</td></tr></tbody></table><br /><div class="separator" style="clear: both; text-align: center;"></div>Illustrating 2 paths :<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-FJXH8TkNihI/UL79DD4HmCI/AAAAAAAADU0/9sKXLI5CkOQ/s1600/screenshot_2098.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="332" src="http://3.bp.blogspot.com/-FJXH8TkNihI/UL79DD4HmCI/AAAAAAAADU0/9sKXLI5CkOQ/s640/screenshot_2098.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">2 path : a straight simple path (red) vs a more advanced one with multiple node and "poke a mole boards"<br />(i'll add real life illustration at the end)</td></tr></tbody></table><br /><br /><br />The RunForestRun campaign that was including DGA was a traffer side work.<br />The js were redirecting to a TDS who could then redirect to other TDS or to Exploit Kits (We saw at least Blackhole and Redkit).<br /><br />Want to read more about TDS and Traffic exchange platform ?<br /><a href="http://www.virusbtn.com/pdf/conference_slides/2011/Goncharov-VB2011.pdf">Using Traffic Direction Systems&nbsp;to simplify fraud... &nbsp;and complicate investigations!</a>&nbsp;- Maxim Goncharov - Trendmicro for VB2011<br /><br /><h3>Traffic Exchange Platforms</h3><div>Won't spend a lot of time here. These are places where traffer/EK operators can register and can sell/buy traffic. There are tools to build this kind of platform</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-gM1s2nwiMt4/UL9M49NRR6I/AAAAAAAADhs/RbB0EfvD3YU/s1600/iRpVIio4KVLVJ.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://2.bp.blogspot.com/-gM1s2nwiMt4/UL9M49NRR6I/AAAAAAAADhs/RbB0EfvD3YU/s640/iRpVIio4KVLVJ.png" width="354" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Small Traffic Exchange Platform (based on Web-Traffic Shop) stats&nbsp;</td></tr></tbody></table><div><br /></div><h3>Domain rotator sytem</h3><div>Tools/utility that cover the need for fast/mass domain rotation.</div><div>Most exploit kits have built-in features for this.</div><div>This was one of the addition to the version 2.0 of Blackhole Exploit Kit.</div><div>This is one of the big feature of Redkit (domain every hours, path every few seconds) , it has also been added to ProPack. The group behind the Cool EK pushing Reveton has also a backend system (I saw at least ten IPs ) with an api to serve active hijacked domains to traffers</div><div><br />Tools :</div><div><br />&nbsp;Qpi Rotator</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-aPxjdFTuEF0/UL8GYRLttkI/AAAAAAAADXk/2w2iA39qJRg/s1600/screenshot_63.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="360" src="http://2.bp.blogspot.com/-aPxjdFTuEF0/UL8GYRLttkI/AAAAAAAADXk/2w2iA39qJRg/s640/screenshot_63.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Qpi Rotator</td></tr></tbody></table><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-BB3R8YaAnSw/UL8HWIFzCqI/AAAAAAAADXs/EoHHvJ3vKbI/s1600/screenshot_60.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="612" src="http://4.bp.blogspot.com/-BB3R8YaAnSw/UL8HWIFzCqI/AAAAAAAADXs/EoHHvJ3vKbI/s640/screenshot_60.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Qpi Rotator Settings allowing domain auto-rotation based blacklisted level</td></tr></tbody></table><div><br /></div><div><br /></div><div><br /></div><div><br /></div><h3>Exploit Kits</h3><div>Won't spend a lot of time here too as most post in this blog are focused on this part.</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-Ew8k67Kn__g/UAxvcABenCI/AAAAAAAAAZA/pv4KpdpHNKc/s1600/scenar.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="480" src="http://1.bp.blogspot.com/-Ew8k67Kn__g/UAxvcABenCI/AAAAAAAAAZA/pv4KpdpHNKc/s640/scenar.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The basics</td></tr></tbody></table><div><br />If you want to see more take a look at these references :<br /><a href="http://contagiodump.blogspot.de/2012/11/common-exploit-kits-2012-poster-based.html">Common Exploit Kits 2012 Poster</a>&nbsp;- 2012-11-11 Mila - Contagio<br /><a href="http://www.kahusecurity.com/2012/wild-wild-west-102012/">Wild Wild West</a>&nbsp;- 2012-23-10 - Kahu Security<br /><a href="http://contagiodump.blogspot.de/2010/06/overview-of-exploit-packs-update.html">An Overview of Exploit Packs (Update 17) October 12, 2012</a>&nbsp;- 2012-10-12 Mila - Contagio</div><br /><h3>A binary life</h3><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-OglkJc2gY4I/UL90qorlLpI/AAAAAAAADjI/rAPnkPyEzMU/s1600/screenshot_96.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="342" src="http://2.bp.blogspot.com/-OglkJc2gY4I/UL90qorlLpI/AAAAAAAADjI/rAPnkPyEzMU/s640/screenshot_96.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">This to illustrate the Crypt and AV Check Services</td></tr></tbody></table><br />. <br />Note that most tools on the path are able to check how clean is a binary, exploit pack or domain.<br /><br /><div>Cool EK check both binary and "sploit pack".<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-QqYJehzohIg/UL8uefbXS5I/AAAAAAAADag/lYx_QBLDdfM/s1600/screenshot_97.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-QqYJehzohIg/UL8uefbXS5I/AAAAAAAADag/lYx_QBLDdfM/s1600/screenshot_97.png" /></a></div><br /></div><div>Redkit (old capture)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-1BBMITHDc0o/UL8zO10BdFI/AAAAAAAADb4/oRArjUD8b-0/s1600/screenshot_100.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-1BBMITHDc0o/UL8zO10BdFI/AAAAAAAADb4/oRArjUD8b-0/s1600/screenshot_100.png" /></a></div><br /><br /></div><div>Blackhole &nbsp;allow binary check through 2 services<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-amPbyaKNrDw/UL8z3bEDdPI/AAAAAAAADcA/R2m9n0_MUDg/s1600/screenshot_101.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-amPbyaKNrDw/UL8z3bEDdPI/AAAAAAAADcA/R2m9n0_MUDg/s1600/screenshot_101.png" /></a></div><br /><br /></div><div>Check feature included in Citadel Botnet<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-LpxJsPz-ItI/UL81cSp6XqI/AAAAAAAADcI/NAfOsdVAlNs/s1600/screenshot_104.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="42" src="http://2.bp.blogspot.com/-LpxJsPz-ItI/UL81cSp6XqI/AAAAAAAADcI/NAfOsdVAlNs/s640/screenshot_104.png" width="640" /></a></div><br /></div>In Upas kit :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-I5YCP5Eji4U/UL9DL-GOEVI/AAAAAAAADfQ/3CuM1qdwAwM/s1600/screenshot_111.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-I5YCP5Eji4U/UL9DL-GOEVI/AAAAAAAADfQ/3CuM1qdwAwM/s1600/screenshot_111.png" /></a></div><br /><h3><span style="font-weight: normal;">Sometimes the crypt provider allow you to add more features than just bypassing Antivirus :</span></h3><div class="separator" style="clear: both; text-align: center;"></div><div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-tOES0Q78R4o/UwJTIPE_2cI/AAAAAAAACXQ/qX2r2BpKRMQ/s1600/screenshot_2014-02-16_005.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="390" src="http://2.bp.blogspot.com/-tOES0Q78R4o/UwJTIPE_2cI/AAAAAAAACXQ/qX2r2BpKRMQ/s1600/screenshot_2014-02-16_005.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Crypt4u. &nbsp;Note : &nbsp;Bypass UAC, Disable Firewall, etc....2014-02-17</td></tr></tbody></table><br /></div><h3></h3><h3>Underground Forums</h3><div>This is a key point where all&nbsp;independent&nbsp;actors exchanges service offers and establish contacts. Reading this blog you'll see many screenshots of announcement or services offer. Forum are also often the place where conflict are solved in section often named "Black"/"Blacklist".<br /><br />If you want an idea on the diversity of services take a look at this advert collection :<br /><a href="http://kafeine.minus.com/mnrcD1JxAzu2U">http://kafeine.minus.com/mnrcD1JxAzu2U</a>&nbsp;(focused on : Traffing, Hosting, Crypting, Virtual Currency Echange, Ransomware affiliates etc...). These advert are found inside services (Forums, Scan, Crypt, Blackhole..etc)<br /><br />So behind an infection there is a dark economy in turmoil with a lot of&nbsp;specialized&nbsp;individuals/groups.<br />We can spend a lot of time discussing about each hat/job in the path. From the domain registration to the hosting, from the coding to the spreading but it was just an eye glance :)<br /><br />Feel free to comment / send remarks kafeine at dontneedcoffee dot com.<br /><br /><b><u>Reading/resources :</u></b><br /><a href="https://www.coursera.org/course/malsoftware">Malicious Software and its Underground Economy: Two Sides to Every Story</a>&nbsp;Lorenzo Cavallaro - Coursera (1st Session July 2013)<br /><br /><br /><br /><br /></div>